name: Linux Build

on: push #[push, pull_request]
jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
    - name: Check out repository
      uses: actions/checkout@v2
      with:
        submodules: true
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y -qq libboost-python1.71.0 build-essential cmake libyaml-cpp-dev libboost-all-dev git libspdlog-dev
    - name: "Checkout open62541"
      uses: actions/checkout@v2
      with:
        repository: open62541/open62541
        path: open62541
        ref: v1.2.4
        submodules: true
    - name: "Build open63541"
      uses: ./.github/actions/build_linux
      with:
        build-type: build_open62541
    - name: "Checkout Catch2"
      uses: actions/checkout@v2
      with:
        repository: catchorg/Catch2
        path: Catch2
        ref: v2.13.4
        submodules: true
    - name: "Build Catch2"
      uses: ./.github/actions/build_linux
      with:
        build-type: build_catch2
    - name: "Go back to this repository"
      run: |
        cd ${{ github.workspace }}
    - name: "Build SAMYCore"
      uses: ./.github/actions/build_linux
      with:
        build-type: build_release
